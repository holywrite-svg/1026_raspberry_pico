# 產品需求文件 (PRD)
## Streamlit MQTT 物聯網監控儀表板

---

## 1. 專案概述

### 1.1 專案名稱
Streamlit MQTT 物聯網監控儀表板

### 1.2 專案背景
建立一個基於 Streamlit 的網頁應用程式，作為 MQTT 訂閱者，即時監控和顯示客廳的物聯網設備狀態，包括電燈開關狀態、溫度及濕度感測器數據。

### 1.3 專案目標
- 提供即時的物聯網設備狀態監控介面
- 視覺化呈現感測器數據變化趨勢
- 自動儲存歷史數據供後續分析使用

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 MQTT 訂閱功能
- **角色定位**：應用程式作為 MQTT 訂閱者（Subscriber）
- **訂閱主題**：
  - `客廳/light` - 電燈開關狀態
  - `客廳/sensor` - 溫濕度感測器數據
- **連接設定**：
  - MQTT Broker 地址：可配置（預設：192.168.0.252）
  - 端口：1883
  - 認證：支援用戶名/密碼認證
- **訊息處理**：
  - 即時接收並解析 JSON 格式訊息
  - 自動處理連線中斷與重連機制

#### 2.1.2 設備狀態顯示
- **電燈狀態監控**
  - 顯示電燈當前狀態（開啟/關閉）
  - 使用視覺化指示器（如圖示、顏色）明確呈現狀態
  - 顯示最後更新時間

- **感測器數據顯示**
  - **溫度顯示**：
    - 即時顯示當前客廳溫度（單位：°C）
    - 顯示溫度數值指標（Metric）
  - **濕度顯示**：
    - 即時顯示當前客廳濕度（單位：%）
    - 顯示濕度數值指標（Metric）

#### 2.1.3 數據視覺化
- **溫濕度趨勢圖表**
  - 使用互動式圖表庫（建議：Plotly）繪製時間序列圖
  - **圖表規格**：
    - X 軸：日期時間（DateTime）
    - Y 軸：數值（溫度與濕度共用 Y 軸，或使用雙 Y 軸）
    - 圖表類型：折線圖（Line Chart）
    - 支援圖表縮放、平移等互動功能
  - **數據範圍**：
    - 顯示最近接收的數據點（建議：最近 100-1000 筆）
    - 支援時間範圍選擇（可選功能）

#### 2.1.4 數據儲存功能
- **Excel 檔案匯出**
  - 將訂閱收到的 MQTT 訊息數據儲存為 Excel 檔案
  - **檔案格式**：
    - 檔案名稱：包含時間戳記（例如：`mqtt_data_20250101_120000.xlsx`）
    - 工作表結構：
      - 欄位 1：時間戳記（Timestamp）
      - 欄位 2：主題（Topic）
      - 欄位 3：溫度（Temperature）
      - 欄位 4：濕度（Humidity）
      - 欄位 5：電燈狀態（Light Status）
      - 欄位 6：原始 JSON 訊息（Raw Message）
  - **儲存時機**：
    - 手動觸發匯出（按鈕）
    - 或自動定期儲存（可選功能）

### 2.2 使用者介面需求

#### 2.2.1 頁面佈局
- **頂部區域**：應用程式標題與 MQTT 連接狀態指示
- **主要內容區**：
  - 設備狀態卡片（電燈、溫度、濕度）
  - 數據圖表區域
- **側邊欄**（可選）：
  - MQTT 連接設定
  - 數據匯出控制
  - 圖表設定選項

#### 2.2.2 視覺設計要求
- 使用清晰的視覺指示器區分設備狀態
- 圖表需具備良好的可讀性
- 響應式設計，適應不同螢幕尺寸

---

## 3. 技術規格

### 3.1 技術棧
- **前端框架**：Streamlit
- **MQTT 客戶端**：paho-mqtt
- **數據處理**：pandas
- **視覺化**：Plotly（推薦）或 Matplotlib
- **檔案處理**：openpyxl 或 pandas（Excel 匯出）

### 3.2 MQTT 訊息格式規範

#### 電燈狀態訊息
```json
{
  "status": "on" | "off",
  "timestamp": "YYYY-MM-DD HH:MM:SS"
}
```

#### 感測器數據訊息
```json
{
  "timestamp": "YYYY-MM-DD HH:MM:SS",
  "temperature": 25.5,
  "humidity": 60.0,
  "status": "正常"
}
```

### 3.3 資料結構
- 使用 Streamlit Session State 管理即時數據
- 數據緩存策略：保留最近 N 筆數據（建議 100-1000 筆）

---

## 4. 非功能性需求

### 4.1 效能需求
- 即時數據更新延遲 < 1 秒
- 圖表渲染流暢，不影響使用者體驗
- 支援至少 1000 筆歷史數據的視覺化

### 4.2 可靠性需求
- MQTT 連接中斷時自動重連
- 錯誤處理機制，避免應用程式崩潰
- 數據完整性驗證

### 4.3 可用性需求
- 介面操作直觀，無需額外說明文件
- 狀態指示清晰明確
- 錯誤訊息友善易懂

---

## 5. 限制與假設

### 5.1 限制
- 本應用程式僅作為數據顯示與儲存工具，**不包含設備控制功能**
- 數據儲存為本地 Excel 檔案，不包含資料庫整合
- 單一使用者使用，不包含多使用者權限管理

### 5.2 假設
- MQTT Broker 已正確設定並運行
- 物聯網設備已正確配置並持續發布數據
- 網路連線穩定

---

## 6. 未來擴展功能（可選）

- 數據統計分析（平均值、最大值、最小值）
- 數據異常警示
- 歷史數據查詢與篩選
- 多房間/多設備支援
- 資料庫整合（取代 Excel 檔案）
- 設備控制功能（發布 MQTT 指令）

---

## 7. 驗收標準

### 7.1 功能驗收
- [ ] 成功連接 MQTT Broker 並訂閱指定主題
- [ ] 正確顯示電燈開關狀態
- [ ] 正確顯示即時溫度和濕度數據
- [ ] 圖表正確繪製，X 軸為時間，Y 軸為溫濕度數值
- [ ] 成功將數據匯出為 Excel 檔案
- [ ] Excel 檔案格式符合規範

### 7.2 品質驗收
- [ ] 介面操作流暢，無明顯延遲
- [ ] 錯誤處理完善，不會因異常數據導致崩潰
- [ ] 程式碼結構清晰，易於維護

---

## 8. 專案時程與里程碑

- **階段一**：MQTT 連接與基本數據接收
- **階段二**：介面開發與狀態顯示
- **階段三**：圖表視覺化實作
- **階段四**：Excel 匯出功能
- **階段五**：測試與優化

---

## 附錄

### A. 相關文件
- `STREAMLIT_GUIDE.md` - Streamlit 使用指南
- `MQTT_BROKER_SETUP.md` - MQTT Broker 設定說明
- `lesson6_0_mqtt_led.py` - MQTT 訂閱範例程式碼

### B. 專有名詞解釋
- **MQTT**：Message Queuing Telemetry Transport，輕量級的發布/訂閱訊息傳輸協議
- **QoS**：Quality of Service，服務品質等級
- **Broker**：MQTT 訊息代理伺服器

---

**文件版本**：1.0  
**最後更新**：2025-01-XX  
**文件維護者**：開發團隊
