好的，這份是關於 MQTT 安裝與使用的完整教學。我們將以最受歡迎的開源 MQTT Broker (伺服器) - Mosquitto 為例進行說明。

本教學假設您使用的是 Debian 或 Ubuntu 系列的 Linux 發行版 (例如 Raspberry Pi OS)。

什麼是 MQTT？
MQTT (Message Queuing Telemetry Transport) 是一種輕量級的訊息傳輸協議，專為物聯網 (IoT) 和低頻寬、不穩定的網路環境設計。它採用「發布/訂閱 (Publish/Subscribe)」模型：

Broker (代理伺服器)：訊息中心，負責接收所有發布者傳來的訊息，並將其轉發給所有訂閱了相關主題的客戶端。
Client (客戶端)：任何連接到 Broker 的設備。它可以是發布者 (Publisher)，也可以是訂閱者 (Subscriber)。
Topic (主題)：訊息的分類標籤，例如 home/living_room/temperature。客戶端可以訂閱自己感興趣的主題。
第 1 步：安裝 Mosquitto Broker 和 Clients
首先，我們需要安裝 Mosquitto 伺服器軟體以及用來測試的客戶端工具。

更新套件列表 打開終端機，執行以下指令來確保您的套件來源是最新的：

bash
sudo apt update
安裝 Mosquitto 接著，安裝 mosquitto (Broker 程式) 和 mosquitto-clients (包含 mosquitto_pub 和 mosquitto_sub 指令)：

bash
sudo apt install mosquitto mosquitto-clients
安裝完成後，Mosquitto Broker 通常會自動啟動並在背景執行。

第 2 步：管理 Mosquitto 服務
您可以使用 systemctl 來管理 Mosquitto 服務的狀態。

檢查服務狀態 確認 Mosquitto 是否正在運行。

bash
sudo systemctl status mosquitto
如果看到 active (running) 字樣，表示服務已成功啟動。

啟動服務

bash
sudo systemctl start mosquitto
停止服務

bash
sudo systemctl stop mosquitto
設定開機自動啟動 (推薦) 讓 Mosquitto 在每次系統開機時自動運行。

bash
sudo systemctl enable mosquitto
第 3 步：MQTT 客戶端指令與測試
mosquitto-clients 套件提供了兩個非常重要的指令，用於發布和訂閱訊息。

mosquitto_sub：訂閱一個主題，接收訊息。
mosquitto_pub：向一個主題發布一則訊息。
現在，我們來實際測試一下。請打開兩個終端機視窗。

在第一個終端機 (訂閱者):

執行以下指令，訂閱名為 test/topic 的主題。-v 選項會讓它顯示主題名稱。

bash
# -h localhost: 連接到本機的 Broker
# -t "test/topic": 訂閱 "test/topic" 這個主題
# -v: 顯示詳細資訊 (包含主題)
mosquitto_sub -h localhost -t "test/topic" -v
執行後，這個終端機會停在這裡，等待接收訊息。

在第二個終端機 (發布者):

執行以下指令，向 test/topic 主題發布一則訊息。

bash
# -h localhost: 連接到本機的 Broker
# -t "test/topic": 指定要發布到的主題
# -m "Hello MQTT!": 指定要發布的訊息內容
mosquitto_pub -h localhost -t "test/topic" -m "Hello MQTT!"
當您按下 Enter 後，您會立刻在第一個終端機看到如下輸出：

plaintext
test/topic Hello MQTT!
這證明您的 MQTT Broker 已經成功運作！

第 4 步：常用指令與選項總結
以下是 mosquitto_pub 和 mosquitto_sub 的常用選項整理：

選項	全名	說明	適用指令
-h	--host	指定 Broker 的主機位址 (預設: localhost)	pub, sub
-p	--port	指定 Broker 的連接埠 (預設: 1883)	pub, sub
-t	--topic	指定要發布或訂閱的主題	pub, sub
-m	--message	指定要發布的訊息內容	pub
-f	--file	從檔案讀取訊息內容並發布	pub
-v	--verbose	顯示詳細資訊 (例如訂閱時顯示主題)	sub
-u	--username	連線時使用的帳號	pub, sub
-P	--pw	連線時使用的密碼	pub, sub
-d	--debug	啟用除錯模式，顯示詳細的協議資訊	pub, sub
第 5 步：設定使用者帳號密碼 (可選但建議)
預設情況下，Mosquitto 允許任何客戶端匿名連接。在實際應用中，為了安全起見，通常會設定帳號密碼。

建立密碼檔案 使用 mosquitto_passwd 指令來建立一個密碼檔案並新增使用者。-c 選項表示建立新檔案。

bash
# 建立密碼檔 /etc/mosquitto/passwd 並新增使用者 'pico'
sudo mosquitto_passwd -c /etc/mosquitto/passwd pico
接著，系統會提示您輸入兩次密碼。

修改 Mosquitto 設定檔 編輯 Mosquitto 的主設定檔。

bash
sudo nano /etc/mosquitto/mosquitto.conf
在檔案的最下方加入以下兩行：

conf
# 禁用匿名登入
allow_anonymous false

# 指定密碼檔案的路徑
password_file /etc/mosquitto/passwd
儲存檔案 (在 nano 中是 Ctrl+O) 並退出 (Ctrl+X)。

重新啟動 Mosquitto 服務 讓新的設定生效。

bash
sudo systemctl restart mosquitto
使用帳號密碼測試 現在，您必須使用 -u 和 -P 選項才能成功發布或訂閱。

bash
# 訂閱
mosquitto_sub -h localhost -t "test/topic" -u "pico" -P "你的密碼" -v

# 發布
mosquitto_pub -h localhost -t "test/topic" -m "Secure Message" -u "pico" -P "你的密碼"
以上就是從安裝到基礎安全設定的完整 MQTT (Mosquitto) 教學。


ho ho
列出MQTT的所有指令


Gemini
Thinking
好的，這是在 Linux 環境下使用 Mosquitto 時，會用到的主要指令大全。這些指令可以分為三大類：

客戶端工具 (Client Tools)：用於模擬設備來發布和訂閱訊息，是測試和除錯時最常用的工具。
伺服器管理 (Broker & Service Management)：用於啟動、停止和設定 MQTT Broker。
安全工具 (Security Tools)：用於管理使用者帳號和密碼。
1. 客戶端工具指令
這些指令來自 mosquitto-clients 套件。

mosquitto_pub (發布訊息)
用來向一個主題發布訊息。

基本語法：

bash
mosquitto_pub [選項] -t <主題> -m <訊息>
常用選項詳解：

選項	全名	說明
-h	--host	Broker 的主機位址 (預設: localhost)。
-p	--port	Broker 的連接埠 (預設: 1883)。
-t	--topic	要發布訊息的主題。
-m	--message	要發布的訊息內容。
-f	--file	從一個檔案讀取內容作為訊息來發布。
-l	--stdin-line	從標準輸入讀取，每行作為一則訊息發布。
-q	--qos	設定服務品質 (QoS) 等級 (0, 1, 或 2)。
-r	--retain	發布一則保留訊息 (Retained Message)。
-i	--id	指定客戶端的 ID。
-u	--username	連線時使用的帳號。
-P	--pw	連線時使用的密碼。
-d	--debug	啟用除錯模式，顯示詳細的協議資訊。
範例：

bash
# 發布一則 QoS 1 的保留訊息到溫感主題
mosquitto_pub -h localhost -t "sensor/temp" -m "25.5" -q 1 -r
mosquitto_sub (訂閱主題)
用來訂閱一個或多個主題，並接收訊息。

基本語法：

bash
mosquitto_sub [選項] -t <主題>
常用選項詳解：

選項	全名	說明
-h	--host	Broker 的主機位址 (預設: localhost)。
-p	--port	Broker 的連接埠 (預設: 1883)。
-t	--topic	要訂閱的主題，可多次使用以訂閱多個主題。
-v	--verbose	顯示訊息時一併顯示主題名稱。
-q	--qos	指定訂閱此主題的 QoS 等級。
-C		接收到指定數量的訊息後自動斷線。
-c	--disable-clean-session	使用持久性會話 (Persistent Session)。
-i	--id	指定客戶端的 ID。
-u	--username	連線時使用的帳號。
-P	--pw	連線時使用的密碼。
-d	--debug	啟用除錯模式，顯示詳細的協議資訊。
範例：

bash
# 訂閱所有 sensor/ 開頭的主題，並顯示主題名稱
mosquitto_sub -h localhost -t "sensor/#" -v -u "myuser" -P "mypass"
2. 伺服器管理指令
mosquitto (Broker 主程式)
這個指令就是 MQTT Broker 本身。雖然通常我們使用 systemctl 來管理它，但你也可以直接從終端機執行它來進行前景除錯。

基本語法：

bash
mosquitto [選項]
常用選項詳解：

選項	全名	說明
-c	--config-file	指定要載入的設定檔路徑。
-p	--port	指定 Broker 監聽的連接埠。
-v	--verbose	詳盡模式，會印出所有連線、訂閱、發布的日誌。
範例：

bash
# 使用指定的設定檔，並在前景以詳盡模式啟動 Broker，方便除錯
mosquitto -c /etc/mosquitto/mosquitto.conf -v
systemctl (服務管理器)
在現代 Linux 系統中，systemctl 是管理背景服務 (daemon) 的標準工具。

指令	說明
sudo systemctl start mosquitto	啟動 Mosquitto 服務。
sudo systemctl stop mosquitto	停止 Mosquitto 服務。
sudo systemctl restart mosquitto	重新啟動 Mosquitto 服務 (修改設定後常用)。
sudo systemctl status mosquitto	檢查 Mosquitto 服務的目前狀態。
sudo systemctl enable mosquitto	設定 Mosquitto 服務開機自動啟動。
sudo systemctl disable mosquitto	取消 Mosquitto 服務開機自動啟動。
3. 安全工具指令
mosquitto_passwd (密碼管理工具)
用於建立和管理 Mosquitto 的密碼檔案。

基本語法：

bash
mosquitto_passwd [選項] <密碼檔案路徑> <使用者名稱>
常用選項詳解：

選項	說明
-c	建立 (Create) 一個新的密碼檔案。注意：此選項會覆蓋現有檔案！
-b	批次模式 (Batch mode)，直接在指令中提供密碼，而不是等待互動式輸入。
-D	刪除 (Delete) 一個指定的使用者。
範例：

bash
 Show full code block 
# 1. 建立一個新的密碼檔，並新增使用者 'admin'
sudo mosquitto_passwd -c /etc/mosquitto/passwd admin

# 2. 在現有的密碼檔中，再新增一個使用者 'device01'
sudo mosquitto_passwd /etc/mosquitto/passwd device01

# 3. (不推薦，但可用於腳本) 使用批次模式新增使用者 'script_user'，密碼為 '123456'
sudo mosquitto_passwd -b /etc/mosquitto/passwd script_user 123456

# 4. 從密碼檔中刪除使用者 'device01'
sudo mosquitto_passwd -D /etc/mosquitto/passwd device01
掌握以上這些指令，您就可以完整地安裝、設定、管理和測試您的 MQTT 環境了。